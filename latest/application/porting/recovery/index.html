<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="icon"  href="/favicon.ico" />
<title>System Recovery</title>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<base id="baseURL" href="/latest/" />
<meta id="docsVersion" content="1.1" />
<meta name="last-modified" content="2019-12-22 19:23:27 +0530" />
<meta http-equiv="cache-control" content="max-age=24" />
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="Cache-Control" content="no-store" />
<meta http-equiv="pragma" content="no-cache" />
<meta http-equiv="Expires" content="600" />

<link rel="stylesheet" href="/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/bootstrap.min.css">
<link rel="stylesheet" href="/css/pygments/perldoc.css">
<link rel="stylesheet" href="/css/style.css?v=22122019">
<link rel="stylesheet" href="/css/github.css?v=22122019">

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-154449679-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-154449679-1');
</script>

</head>
<body class=" latestVersion">
	 
	<header>
    <div class="header">
        <nav class="nav-secondary-tabs affix" >
            <div class="container-fluid">
                <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
                    <div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container">
    <a class="logo" href="/" title="Tizen Documentation">
        Tizen
    </a>
    <div id="tabs">
        
        
        <ul class="tabs" id="jsTOCHorizontal">
            <li class="">
                <a href="design/">Design</a>
            </li>
            <li class="active">
                <a href="application/">Platform</a>
            </li>
            <!--li class="">
                <a href="iot/">IoT</a-->
            </li>
            <li class=" dropdown">
                <a href="visualstudio/" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Visual Studio<span class="caret"></span></a>
                <ul class="dropdown-menu nav-main">
                    
                    <li><a href="visualstudio/vstools/index/">Visual Studio Tools For Tizen</a></li>
                    <li><a href="visualstudio/vscode-ext/index/">Visual Studio Code Extension For Tizen</a></li>
                    <li><a href="visualstudio/vstools-mac/overview/">Visual Studio For Mac Extension for Tizen</a></li>
                 </ul>
            </li>
            <li class="">
                <a href="tizenstudio/setup/overview/">Tizen Studio</a>
            </li>
             <li class=" dropdown">
                <a href="iot/" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">IoT<span class="caret"></span></a>
                <ul class="dropdown-menu nav-main">
                    <li><a href="iot/extensionsdk/">IoT Extension SDK</a></li>
                    <li><a href="iot/iot-partners/nubison/">IoT partners</a></li>
                 </ul>
            </li>
            <li class="">
                <a href="tizenstudio/setup/overview/">Blogs</a>
            </li>
            <li class="">
                <a href="tizenstudio/setup/overview/">Community</a>
            </li>
        </ul>
    </div>
    <div class="ctrl-right hidden-xs hidden-sm">
        <a href="javascript:void(0)" id="menu-toggle"><i class="fa fa-indent" aria-hidden="true"></i></a>
        <div class="widgetVersionSwitcher"></div>
    </div>
    <div class="search-form">
        <form action="search.html">
            <input class="search-field form-control ds-input st-search-input" value="" name="q" placeholder="Search the docs" type="search" autocomplete="off" spellcheck="false" dir="auto">
            <button type="submit" class="search-button">
                <i class="fa fa-search"></i>
            </button>
        </form>
    </div>
    
</div>

                </div>
            </div>
        </nav>
    </div>
</header>
    <div class="wrapper right-open">
		<div class="container-fluid">
			<div class="row">
				<div class="col-body">
					<main class="col-content content">
						<section class="section">
							<nav class="breadcrumbs bootstrap hidden-sm-down">
   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

       
          
      
      <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
         <a property="item" typeof="WebPage" href="/latest/">
            <span property="name">Documentation</span>
            <meta property="position" content="1" />
         </a>
      </li>
       
          
      
      <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
         <a property="item" typeof="WebPage" href="/latest/application/">
            <span property="name">Application</span>
            <meta property="position" content="2" />
         </a>
      </li>
       
          
      
      <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
         <span property="name">System Recovery</span>
         <meta property="position" content="3" />
      </li>
      
   </ol>
</nav>


							<div class="widgetLatestVersionNotification"></div>
							<h1 class="page-title">
								System Recovery
							</h1>
							<div class="page-read-time">
								<span class="reading-time" title="Estimated read time">
    
    
    12 mins read
    
</span>
							</div>
							<div class="page-content">
								<h1 id="system-recovery">System Recovery</h1>

<p>Tizen 4.0 comes with 3 different root filesystems, each designed for a different purpose.</p>

<p><strong>Table: Root filesystems</strong></p>

<table>
  <thead>
    <tr>
      <th>Label</th>
      <th>Purpose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">rootfs</code></td>
      <td>Main root filesystem</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">ramdisk</code></td>
      <td>Regular boot ramdisk</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">ramdisk-recovery</code></td>
      <td>System recovery ramdisk</td>
    </tr>
  </tbody>
</table>

<p>This topic describes operation and customization options of the system
recovery ramdisk.</p>

<p>The following steps describe the boot process:</p>

<ol>
  <li>
    <p>The boot process starts with a bootloader (u-boot or s-boot) loading
appropriate kernel and ramdisk images dedicated for the system
recovery process (methods for controlling bootloader actions are beyond the
scope of this document). With both images loaded into RAM, the kernel
initialization begins. When the initialization is complete, the kernel passes
control to the init process, such as <code class="highlighter-rouge">/sbin/init</code> (PID#1).</p>
  </li>
  <li>
    <p>In the case of the recovery ramdisk, <code class="highlighter-rouge">/sbin/init</code> is a symlink to
<code class="highlighter-rouge">/usr/libexec/initrd-recovery/init</code> (a shell script that comes
from the <code class="highlighter-rouge">initrd-recovery</code> package). The script mounts several kernel
filesystems and the inform partition (if it exists), and parses the
kernel command line options (<code class="highlighter-rouge">/proc/cmdline</code>) to find the <code class="highlighter-rouge">bootmode</code>
parameter. If the parameter is present, one of the <code class="highlighter-rouge">/sbin/*-init</code> scripts is
started. If the boot mode is set to <code class="highlighter-rouge">recovery</code>,
<code class="highlighter-rouge">/usr/libexec/system-recovery/recovery-init</code> is started.</p>
  </li>
  <li>
    <p>The <code class="highlighter-rouge">recovery-init</code> script mounts the real root filesystem under
the <code class="highlighter-rouge">/system</code> directory, and other filesystems (such as <code class="highlighter-rouge">/opt</code> and
<code class="highlighter-rouge">/opt/usr</code>) below the <code class="highlighter-rouge">/system</code> directory. The script starts a shell on the serial console and launches the
<code class="highlighter-rouge">system-recovery</code> program.</p>
  </li>
  <li>
    <p>The <code class="highlighter-rouge">system-recovery</code> program can work as either an interactive GUI or
a non-interactive dispatcher, executing 1 (non-interactive) or
more (interactive) actions. The actions are configured in the
<code class="highlighter-rouge">/usr/share/system-recovery/system-recovery.cfg</code> file.</p>
  </li>
</ol>

<h2 id="configuration-file">Configuration File</h2>

<p>The configuration file allows you to customize 2 aspects of
the system-recovery operation: GUI and actions. The following sections take a closer look
at the actions.</p>

<p>The configuration file is parsed using <code class="highlighter-rouge">libconfig</code>. For a detailed description of the
grammar, see the <a href="http://hyperrealm.com/libconfig/libconfig_manual.html#Configuration-File-Grammar">libconfig documentation</a>.</p>

<h3 id="action_handlers"><code class="highlighter-rouge">action_handlers</code></h3>

<p><code class="highlighter-rouge">action_handlers</code> is a dictionary, in which shell commands (action
handlers) are assigned names (actions). The names are used later in
the configuration to refer to commands. The dictionary can be edited
and actions can be added or removed. The names must be unique.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>action_handlers = {
    reboot = "reboot -f";
    factory-reset = "touch -f /opt/.factoryreset";
    safeboot = "touch -f /opt/etc/.safeboot";
}
</code></pre></div></div>

<h3 id="menus"><code class="highlighter-rouge">menus</code></h3>

<p>Actions (names) are used in the <code class="highlighter-rouge">menus</code> dictionary, which
comprises all pages of the menu system presented by
<code class="highlighter-rouge">system-recovery</code>. The <code class="highlighter-rouge">main</code> entry is the one the program displays
at startup. The rest must be linked in a tree-like structure.</p>

<p>Each menu entry consists of the following fields:</p>

<ul>
  <li><code class="highlighter-rouge">pos_x</code> and <code class="highlighter-rouge">pox_y</code>: Position on a screen</li>
  <li><code class="highlighter-rouge">style</code>: Reference to the <code class="highlighter-rouge">menu_styles</code> dictionary</li>
  <li><code class="highlighter-rouge">actions</code>: Array of actions available in this menu</li>
  <li><code class="highlighter-rouge">item_default</code>: Action to highlight when opening the menu</li>
</ul>

<p>The <code class="highlighter-rouge">system-recovery</code> program can handle an action in 2 ways: it can run an action handler
or switch to another screen. There is a reserved screen name <strong>BACK</strong>, which
means switching to the previous screen (for more information, see <code class="highlighter-rouge">screen_back</code> in the <a href="#screens">screens
dictionary</a>).</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>menus = {
    main = {
        pos_x = 0;
        pos_y = 100;
        style = "common";
        actions = ({
            label = "Reboot system now";
            screen_switch_to = "reboot";
        },{
            label = "Safe mode";
            screen_switch_to = "safe";
        },{
            label = "Phone reinitialisation";
            screen_switch_to = "factory";
        });
    };
    reboot = {
        pos_x = 0;
        pos_y = 480;
        style = "common";
        item_default = 1;
        actions = ({
            label = "Yes";
            action_handler = "reboot";
            exit_after_action = 0;
        },{
            label = "No";
            screen_switch_to = "BACK";
        });
    };
    safe = {
        pos_x = 0;
        pos_y = 480;
        style = "common";
        item_default = 1;
        actions = ({
            label = "Yes";
            action_handler = "safeboot";
            exit_after_action = 1;
        },{
            label = "No";
            screen_switch_to = "BACK";
        });
    };
    factory = {
        pos_x = 0;
        pos_y = 480;
        style = "common";
        item_default = 1;
        actions = ({
            label = "Yes";
            screen_switch_to = "factory-run";
            action_handler = "factory-reset";
            exit_after_action = 1;
        },{
            label = "No";
            screen_switch_to = "BACK";
        });
    };
};
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong></p>

  <p>The <code class="highlighter-rouge">system-recovery.cfg.m4.in</code> source file provides the <code class="highlighter-rouge">confirm_action</code> m4 macro to define a <strong>Yes/No</strong> style action array:</p>
  <ul>
    <li><strong>Yes</strong> executes an action.</li>
    <li><strong>No</strong> switches to a previous screen.</li>
  </ul>

  <p>Use this macro when adding an action to the config file in the repository.</p>

  <p>For example:</p>
  <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>actions = confirm_action('safeboot', 1);
</code></pre></div>  </div>
  <p>Expands to:</p>
  <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>actions = ({
    label = "Yes";
    action_handler = "safeboot";
    exit_after_action = 1;
},{
    label = "No";
    screen_switch_to = "BACK";
});
</code></pre></div>  </div>

  <p>The first argument of the macro is an action, and the second is the value to assign to the <code class="highlighter-rouge">exit_after_action</code> element.</p>
</blockquote>

<h3 id="screens"><code class="highlighter-rouge">screens</code></h3>

<p>Each action can either execute an action handler (a shell command) or switch to a screen. The screens are configured in
their dictionary as follows:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>screens = {
    main = {
        style = "common";
        menu = "main";
        description = "main";
        rulers = "main";
        images = ("background_default", "menu_title");
        screen_back = "CURRENT";
    };
    reboot = {
        style = "common";
        menu = "reboot";
        description = "reboot"
        rulers = "confirm";
        images = ("background_default", "menu_title");
        screen_back = "main";
    };
    safe = {
        style = "common";
        menu = "safe";
        description = "safe";
        rulers = "confirm";
        images = ("background_default", "menu_title");
        screen_back = "main";
    };
    factory = {
        style = "common";
        menu = "factory";
        description = "factory";
        rulers = "confirm";
        images = ("background_default", "menu_title");
        screen_back = "main";
    };
    factory-run = {
        style = "common";
        description = "factory-run";
        rulers = "confirm";
        images = ("background_default", "menu_title");
        animations = ("working");
        screen_back = "main";
        allow_force_reboot = 1;
    };
};
</code></pre></div></div>

<p>The above entries contain 2 parameter groups:</p>

<ul>
  <li>The first group is responsible for the look of a screen:
    <ul>
      <li><code class="highlighter-rouge">style</code>: Element of the <code class="highlighter-rouge">screen_styles</code> dictionary</li>
      <li><code class="highlighter-rouge">rulers</code>: Element of the <code class="highlighter-rouge">rulers</code> dictionary</li>
      <li><code class="highlighter-rouge">images</code>: List of elements of the <code class="highlighter-rouge">images</code> dictionary</li>
      <li><code class="highlighter-rouge">animations</code>: Element of the <code class="highlighter-rouge">animations</code> dictionary</li>
    </ul>

    <p>These parameters are not described in detail in this document.</p>
  </li>
  <li>The second group comprises parameters that describe logic:
    <ul>
      <li><code class="highlighter-rouge">menu</code>: Menu to display (an element of the <code class="highlighter-rouge">menus</code> dictionary)</li>
      <li><code class="highlighter-rouge">description</code>: Description text and screen title to display (an element of the <code class="highlighter-rouge">descriptions</code> dictionary)</li>
      <li><code class="highlighter-rouge">screen_back</code>: Screen to switch to when switching <strong>BACK</strong></li>
      <li><code class="highlighter-rouge">allow_force_reboot</code>: Reboot after executing an action</li>
    </ul>
  </li>
</ul>

<h3 id="descriptions"><code class="highlighter-rouge">descriptions</code></h3>

<p>The elements of the <code class="highlighter-rouge">descriptions</code> dictionary hold screen titles and
brief descriptions for screen entries:</p>

<ul>
  <li><code class="highlighter-rouge">title</code>: Short (one line) title displayed at the top of a screen</li>
  <li><code class="highlighter-rouge">description</code>: Brief explanation of actions available on the screen</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>descriptions = {
    main = {
        pos_x = 15;
        pos_y = 480;
        style = "common";
        title = "Controls:";
        text = "Volume Up/Down to move menu cursor\n"
            "Power button to select";
    };

    reboot = {
        pos_x = 15;
        pos_y = 100;
        title = "The phone will be restarted.";
        text = "Continue?";
        style = "common";
    };

    safe = {
        pos_x = 15;
        pos_y = 100;
        title = "Safe mode:",
        text = "The phone will be started in safe mode.\n"
            "Home screen will be changed to default\n"
            "setting and just allow a user to use\n"
            "only preloaded applications.\n"
            "Continue?";
        style = "common";
    };

    factory = {
        pos_x = 15;
        pos_y = 100;
        title = "Factory reset (except SD-card)";
        text = "This will erase all data from your\n"
            "phone's internal storage, including\n"
            "settings of downloaded and preloaded\n"
            "applications and system configuration.\n"
            "Continue?";
        style = "common";
    };

    factory-run = {
        pos_x = 15;
        pos_y = 100;
        style = "common";
        title = "Restoring settings to factory default.";
        text = "Please wait. Do not turn off.\n"
            "(Hold power button for 3 seconds\n"
            "to reboot the device. Not recommended.)";
    }
};
</code></pre></div></div>

<h2 id="non-interactive-operation">Non-interactive Operation</h2>

<p>If the <code class="highlighter-rouge">system-recovery</code> program is compiled without GUI support, only 2 parameters
in the configuration file control how the program behaves:</p>

<ul>
  <li><code class="highlighter-rouge">action_handlers</code>: List of shell commands</li>
  <li><code class="highlighter-rouge">headless_action</code>: Action to execute by default</li>
</ul>

<p>Before <code class="highlighter-rouge">system-recovery</code> reads the <code class="highlighter-rouge">headless_action</code> parameter, it looks
for the action to execute in 2 other places:</p>

<ul>
  <li><code class="highlighter-rouge">tizen.recovery</code> kernel command line option (such as <code class="highlighter-rouge">tizen.recovery=factory-reset</code>)</li>
  <li><code class="highlighter-rouge">/opt/.recovery.action</code></li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>headless_action = "factory-reset";
</code></pre></div></div>

<h2 id="adding-new-actions">Adding New Actions</h2>

<p>To add a new action:</p>

<ol>
  <li>Define an action handler in the <code class="highlighter-rouge">action_handlers</code> dictionary:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>action_handlers = {
    factory-reset-minimal = "/usr/bin/factory-reset-minimal.sh"
};
</code></pre></div>    </div>
  </li>
  <li>Take the <code class="highlighter-rouge">factory</code> entry from the <code class="highlighter-rouge">menus</code> dictionary and adapt it:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>menus = {
    factory-minimal = {
        pos_x = 0;
        pos_y = 480;
        style = "common";
        item_default = 1;
        actions = ({
            label = "Yes";
            screen_switch_to = "factory-run-minimal";
            action_handler = "factory-reset-minimal";
            exit_after_action = 1;
        },{
            label = "No";
            screen_switch_to = "BACK";
        });
    };
};
</code></pre></div>    </div>
  </li>
  <li>Add 2 new entries in the <code class="highlighter-rouge">screens</code> dictionary:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>screens = {
    factory-minimal = {
        style = "common";
        menu = "factory-minimal";
        description = "factory-minimal";
        rulers = "confirm";
        images = ("background_default", "menu_title");
        screen_back = "main";
    };
    factory-run-minimal = {
        style = "common";
        description = "factory-run-minimal";
        rulers = "confirm";
        images = ("background_default", "menu_title");
        animations = ("working");
        screen_back = "main";
        allow_force_reboot = 1;
    };
};
</code></pre></div>    </div>
  </li>
  <li>Add 2 new entries in the <code class="highlighter-rouge">descriptions</code> dictionary:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>descriptions = {
    factory-minimal = {
        pos_x = 15;
        pos_y = 100;
        title = "Factory reset (except SD-card)";
        text = "This will erase SOME data from your\n"
            "phone's internal storage, including\n"
            "settings of downloaded and preloaded\n"
            "applications and system configuration.\n"
            "Continue?";
        style = "common";
    };
    factory-run-minimal = {
        pos_x = 15;
        pos_y = 100;
        style = "common";
        title = "Restoring SOME settings to factory default.";
        text = "Please wait. Do not turn off.\n"
            "(Hold power button for 3 seconds\n"
            "to reboot the device. Not recommended.)";
    };
};
</code></pre></div>    </div>
  </li>
  <li>Add an action to the <code class="highlighter-rouge">main</code> menu that switches to the <code class="highlighter-rouge">factory-minimal</code> screen:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>main = {
    pos_x = 0;
    pos_y = 100;
    style = "common";
    actions = ({
        label = "Reboot system now";
        screen_switch_to = "reboot";
    },{
        label = "Safe mode";
        screen_switch_to = "safe";
    },{
        label = "Phone reinitialisation";
        screen_switch_to = "factory";
    },{
        label = "Minimal phone reinitialisation";
        screen_switch_to = "factory-minimal";
    });
};
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="look-and-feel-options">Look-and-feel Options</h2>

<p>The following example shows the remaining parts of the configuration file, containing options that control the look-and-feel of the system recovery menus:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>colors = {
    background = "#000000ff";
    title = "#1bc7ccff";
    ruler = "#1bc7ccff";
    white = "#ffffffff";
};

ruler_styles = {
    common = {
        c_ruler = "ruler";
    };
};

menu_styles = {
    common = {
        item_height = 80;
        item_spacing = 8;
        text_pos_x = 15;
        c_bg_selected = "title";
        c_bg_unselected = "background";
        c_text_selected = "white";
        c_text_unselected = "white";
    };
};

screen_styles = {
    common = {
        c_background = "background";
    };
};

description_styles = {
    common = {
        c_title = "title";
        c_text = "white";
    };
};

rulers = {
    main = (
    {
        pos_x = 0;
        pos_y = 80;
        height = 2;
        style = "common";
    }, {
        pos_x = 0;
        pos_y = 420;
        height = 2;
        style = "common";
    });

    confirm = (
    {
        pos_x = 0;
        pos_y = 80;
        height = 2;
        style = "common";
    });
};

images = {
    background_default = {
        fname = "/usr/share/system-recovery/res/images/warning.png";
        c_bg = "background"; // reference to colors
        align_hor = "center";
        align_ver = "bottom";
        offset_x = 0;
        offset_y = 0;
        img_type = "alpha"; // alt: "no-alpha";
    };
    menu_title = {
        fname = "/usr/share/system-recovery/res/images/menu-title.png";
        c_bg = "title";
        align_hor = "center";
        align_ver = "top";
        offset_x = 0;
        offset_y = 20;
        img_type = "no-alpha"; // alt: "no-alpha";
    };
};

animations = {
    working = {
        fname = "/usr/share/system-recovery/res/images/tizen-anim.png";
        c_bg = "background";
        align_hor = "center";
        align_ver = "middle";
        offset_x = 0;
        offset_y = 0;
        frames_num = 0;
        current_frame = 0;
        img_type = "no-alpha"; // alt: "no-alpha";
    };
};
</code></pre></div></div>

<h2 id="adding-new-files-to-the-ramdisk-recovery-partition">Adding New Files to the <code class="highlighter-rouge">ramdisk-recovery</code> Partition</h2>

<p>The <code class="highlighter-rouge">ramdisk-recovery</code> partition is created along with the <code class="highlighter-rouge">rootfs</code>
partition (methods for creating images are beyond the scope of this
document):</p>

<ul>
  <li>Files to be added to the <code class="highlighter-rouge">ramdisk-recovery</code> partition must
be available in Tizen RPM packages.</li>
  <li>Files are added to the partition by the <code class="highlighter-rouge">mkinitrd-recovery.sh</code> script, which is started
automatically as a part of the <code class="highlighter-rouge">%posttrans</code> RPM script of the <code class="highlighter-rouge">initrd-recovery</code> package.</li>
</ul>

<p>To install a selected file in the recovery
image, its RPM needs to be installed before <code class="highlighter-rouge">initrd-recovery</code> is run. The
easiest way to make sure this happens is to list the package as a
dependency in the <code class="highlighter-rouge">initrd-recovery.spec</code> file.</p>

<p>The <code class="highlighter-rouge">mkinitrd-recovery.sh</code> script copies or moves files from the
<code class="highlighter-rouge">rootfs</code> partition to the <code class="highlighter-rouge">initrd-recovery</code> partition according to
directions provided in configuration files stored in the
<code class="highlighter-rouge">/usr/share/initrd-recovery/initrd.list.d</code> directory. These files
must be packaged in the RPM packages together with the
files to be put on the <code class="highlighter-rouge">initrd-recovery</code> partition. The configuration files are
interpreted as shell scripts and can be used to set the following
variables:</p>

<ul>
  <li><code class="highlighter-rouge">DIRECTORIES</code>: Create directories.</li>
  <li><code class="highlighter-rouge">DIR_SYMLINKS</code>: Create symbolic links to directories.</li>
  <li><code class="highlighter-rouge">LIBONLYS</code>: Copy <strong>only</strong> the libraries required by the listed executable files.</li>
  <li><code class="highlighter-rouge">MVWITHLIBS</code>: Move the listed executable files and copy the required libraries.</li>
  <li><code class="highlighter-rouge">SYMLINKS</code>: Create symbolic links.</li>
  <li><code class="highlighter-rouge">VERBATIMS</code>: Copy the listed files. List non-executable files here.</li>
  <li><code class="highlighter-rouge">WITHLIBS</code>: Copy the listed executable files and the required libraries.</li>
</ul>

<p>The <code class="highlighter-rouge">SYMLINKS</code> and <code class="highlighter-rouge">DIR_SYMLINKS</code> variables contain pairs of filenames separated with
colons.</p>

<p>The following section contains examples of the above variables:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DIRECTORIES="
/var/tmp
/usr/lib/odbc
"

# LinkFileName:Target
DIR_SYMLINKS="
/lib:usr/lib
/opt:system/opt
"

LIBONLYS="
/bin/bash
/bin/kill
"

MVWITHLIBS="
/usr/libexec/initrd-recovery/minireboot
/usr/libexec/system-recovery/system-recovery.gui
"

WITHLIBS="
/usr/bin/sync
/usr/bin/touch
"

VERBATIMS="
/usr/share/system-recovery/res/images/font.png
/usr/share/system-recovery/res/images/menu-title.png
/usr/share/system-recovery/system-recovery.cfg
"

# LinkFileName:Target
SYMLINKS="
/sbin/recovery-init:/usr/libexec/system-recovery/recovery-init
/usr/lib/bufmgr/libtbm_default.so:libtbm_sprd.so
"
</code></pre></div></div>

<p>The following real-world example comes from the <code class="highlighter-rouge">initrd-recovery</code>
package. Following this configuration, <code class="highlighter-rouge">mkinitrd-recovery.sh</code> copies
some basic tools to the <code class="highlighter-rouge">initrd-recovery</code> partition, moves <code class="highlighter-rouge">init</code> and
<code class="highlighter-rouge">minireboot</code>, and creates some symlinks:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MVWITHLIBS="
/usr/libexec/initrd-recovery/init
/usr/libexec/initrd-recovery/minireboot
"

WITHLIBS="
/usr/bin/bash
/usr/bin/cat
/usr/bin/mkdir
/usr/bin/mount
/usr/bin/sleep
/usr/bin/sync
/usr/bin/umount
/usr/sbin/blkid
"

# LinkFileName:Target
SYMLINKS="
/bin/sh:bash
/sbin/init:/usr/libexec/initrd-recovery/init
/sbin/minireboot:/usr/libexec/initrd-recovery/minireboot
/sbin/reboot:/usr/libexec/initrd-recovery/minireboot
"
</code></pre></div></div>

								
            						


  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'https://samsung-test.github.io/latest//application/porting/recovery/';
      this.page.identifier = 'https://samsung-test.github.io/latest//application/porting/recovery/';
    };
    (function() {
      var d = document, s = d.createElement('script');
      s.src = 'https://samsung-test.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


         						
							</div>
						</section>
					</main>
					<nav class="col-nav">
						<div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
						    


<div id="navbar" class="nav-sidebar">
    <ul class="nav" id="jsTOCLeftNav">
        
        
        
        
    
        <li>
            <a 
                href="application/about/work-flow/" 
                data-target="#item1" 
                data-toggle="collapse" 
                data-parent="#stacked-menu"
                aria-expanded=" false "
                class=" collapsed "
                >
                    Application Overview
                    <span class="caret arrow"></span>
            </a>
            

            
            <ul class="nav collapse" aria-expanded="false" id="#item1">
            

                
                <li>
                    
                    
                    <a 
                        href="application/about/work-flow/" 
                        class=""
                        >
                        Application Development Workflow
                    </a>
                    
                </li>
                
                <li>
                    
                    
                    <a 
                        href="application/about/git-repo-structure/" 
                        class=""
                        >
                        Application Git Repository Structure
                    </a>
                    
                </li>
                
                <li>
                    
                    
                    <a 
                        href="application/about/conventions/" 
                        class=""
                        >
                        Typographic Conventions
                    </a>
                    
                </li>
                
            </ul>
            
        </li>
    
        
        
        
    
        <li>
            <a 
                href="application/developing/installing/" 
                data-target="#item2" 
                data-toggle="collapse" 
                data-parent="#stacked-menu"
                aria-expanded=" false "
                class=" collapsed "
                >
                    Application Developing
                    <span class="caret arrow"></span>
            </a>
            

            
            <ul class="nav collapse" aria-expanded="false" id="#item2">
            

                
                <li>
                    
                    
                    <a 
                        href="application/developing/installing/" 
                        class=""
                        >
                        Installing Development Tools
                    </a>
                    
                </li>
                
                <li>
                    
                    
                    <a 
                        href="application/developing/setting-up/" 
                        class=""
                        >
                        Setting up Development Environment
                    </a>
                    
                </li>
                
                <li>
                    
                    
                    <a 
                        href="application/developing/cloning/" 
                        class=""
                        >
                        Cloning Tizen Source Files
                    </a>
                    
                </li>
                
                <li>
                    
                    
                    <a 
                        href="application/developing/building/" 
                        class=""
                        >
                        Building Packages Locally with GBS
                    </a>
                    
                </li>
                
                <li>
                    
                    
                    <a 
                        href="application/developing/building-all/" 
                        class=""
                        >
                        Building All Packages Locally with GBS
                    </a>
                    
                </li>
                
                <li>
                    
                    
                    <a 
                        href="application/developing/contributing/" 
                        class=""
                        >
                        Contributing Code to Tizen
                    </a>
                    
                </li>
                
                <li>
                    
                    
                    <a 
                        href="application/developing/creating/" 
                        class=""
                        >
                        Creating Tizen Images with MIC
                    </a>
                    
                </li>
                
                <li>
                    
                    
                    <a 
                        href="application/developing/flashing/" 
                        class=""
                        >
                        Flashing an Image to Device
                    </a>
                    
                </li>
                
                <li>
                    
                    
                    <a 
                        href="application/developing/tips/" 
                        class=""
                        >
                        Development Tips
                    </a>
                    
                </li>
                
            </ul>
            
        </li>
    
        
        
        
    
        <li>
            <a 
                href="application/porting/overview" 
                data-target="#item3" 
                data-toggle="collapse" 
                data-parent="#stacked-menu"
                aria-expanded=" true "
                class=" not-collapsed "
                >
                    Porting
                    <span class="caret arrow"></span>
            </a>
            

            
            <ul class="nav collapse in" aria-expanded="true" id="#item3">
            

                
                <li>
                    
                    
                    <a 
                        href="application/porting/overview/" 
                        class=""
                        >
                        Overview
                    </a>
                    
                </li>
                
                <li>
                    
                    
                    <a 
                        href="application/porting/kernel/" 
                        class=""
                        >
                        Kernel
                    </a>
                    
                </li>
                
                <li>
                    
                    
                    <a 
                        href="application/porting/system/" 
                        class=""
                        >
                        System
                    </a>
                    
                </li>
                
                <li>
                    
                    
                    <a 
                        href="application/porting/graphics-and-ui/" 
                        class=""
                        >
                        Graphics and UI
                    </a>
                    
                </li>
                
            </ul>
            
        </li>
    
        
        
        
    
        <li>
            <a 
                href="application/reference/gerrit-usage/" 
                data-target="#item4" 
                data-toggle="collapse" 
                data-parent="#stacked-menu"
                aria-expanded=" false "
                class=" collapsed "
                >
                    Reference
                    <span class="caret arrow"></span>
            </a>
            

            
            <ul class="nav collapse" aria-expanded="false" id="#item4">
            

                
                <li>
                    
                    
                    <a 
                        href="application/reference/gerrit-usage/" 
                        class=""
                        >
                        Gerrit
                    </a>
                    
                </li>
                
                <li>
                    
                    
                    <a 
                        href="application/reference/gbs/gbs-overview/"
                        class=""
                        aria-expanded=" false "
                        data-target="#item2" 
                        data-toggle="collapse" 
                        >
                        Git Build System (GBS)
                        <span class="caret arrow"></span>
                    </a>
                    
                    
                    <ul class="nav collapse" aria-expanded="false" id="#item2">
                    
                        
                        <li>
                            
                            <a 
                                href="application/reference/gbs/gbs-overview/"
                                class=""
                                >
                                Overview
                            </a>
                        </li>
                        
                        <li>
                            
                            <a 
                                href="application/reference/gbs/gbs.conf/"
                                class=""
                                >
                                GBS Configuration
                            </a>
                        </li>
                        
                        <li>
                            
                            <a 
                                href="application/reference/gbs/gbs-maintenance-models/"
                                class=""
                                >
                                GBS Maintenance Models
                            </a>
                        </li>
                        
                    </ul>
                    
                </li>
                
                <li>
                    
                    
                    <a 
                        href="application/reference/mic/mic-overview/"
                        class=""
                        aria-expanded=" false "
                        data-target="#item3" 
                        data-toggle="collapse" 
                        >
                        MIC Image Creator
                        <span class="caret arrow"></span>
                    </a>
                    
                    
                    <ul class="nav collapse" aria-expanded="false" id="#item3">
                    
                        
                        <li>
                            
                            <a 
                                href="application/reference/mic/mic-overview/"
                                class=""
                                >
                                Overview
                            </a>
                        </li>
                        
                        <li>
                            
                            <a 
                                href="application/reference/mic/mic-customize-image/"
                                class=""
                                >
                                Customizing Images
                            </a>
                        </li>
                        
                        <li>
                            
                            <a 
                                href="application/reference/mic/mic-reference/"
                                class=""
                                >
                                MIC Reference
                            </a>
                        </li>
                        
                    </ul>
                    
                </li>
                
            </ul>
            
        </li>
    
        
        
    </ul>
</div>
<script>
    $("a[href$='/application/porting/recovery/']").addClass("active currentPage");
</script>
						</div>
					</nav>
					<div class="col-toc">
						<div class="sidebar hidden-xs hidden-sm">
							<div class="toc-nav">
								<div class="feedback-links">
									<ul>
										<li>
                                            <a href="https://github.com/samsung-test/samsung-test.github.io/edit/1.1/application/porting/recovery.md" target="_blank">
                                                <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                                                Edit Page
                                            </a>
                                        </li>
                                        <li>
                                            <a href="https://github.com/samsung-test/samsung-test.github.io/issues/new" class="nomunge" target="_blank">
                                                <i class="fa fa-exclamation-circle" aria-hidden="true"></i>
                                                Report Issue
                                            </a>
                                        </li>
									</ul>
								</div>
								   
									<div id="side-toc-title">On this page:</div>
									
<ul id="my_toc" class="inline_toc">
  <li><a href="#configuration-file" class="nomunge">Configuration File</a>
    <ul>
      <li><a href="#action_handlers" class="nomunge">action_handlers</a></li>
      <li><a href="#menus" class="nomunge">menus</a></li>
      <li><a href="#screens" class="nomunge">screens</a></li>
      <li><a href="#descriptions" class="nomunge">descriptions</a></li>
    </ul>
  </li>
  <li><a href="#non-interactive-operation" class="nomunge">Non-interactive Operation</a></li>
  <li><a href="#adding-new-actions" class="nomunge">Adding New Actions</a></li>
  <li><a href="#look-and-feel-options" class="nomunge">Look-and-feel Options</a></li>
  <li><a href="#adding-new-files-to-the-ramdisk-recovery-partition" class="nomunge">Adding New Files to the ramdisk-recovery Partition</a></li>
</ul>


								</div>
								
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	
    <div class="container-fluid">
  <div class="top_footer">
    <div class="footer-nav">
      <nav class="footer_sub_nav">
        <ul class="menu">
          <li><a href="https://developer.tizen.org/">Developer</a></li>
          <li><a href="https://dashboard.tizen.org/">Dashboard</a></li>
          <li><a href="https://craftroom.tizen.org/">Craftroom</a></li>
        </ul>
      </nav>
    </div>
  </div>
  <div class="bottom_footer">
    <div class="footer-copyright col-xs-12 col-md-8">
      <p class="copyright">
        Copyright &copy; 2019 Tizen Inc. All rights reserved.
      </p>
    </div>
    <div class="footer_social_nav">
      <ul class="nav-social">
        <li class="fa fa-github"><a href="https://github.com/samsung-test">GitHub</a></li>  
        <li class="fa fa-twitter"><a href="https://twitter.com/TizenProject">Twitter</a></li>
        <li class="fa fa-facebook"><a href="http://www.facebook.com/pages/Tizen-Project">Facebook</a></li>
      </ul>
    </div>
  </div>
</div>


    <div id="templates"></div>
    <script type="text/javascript" src="/js/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/js/common.js?v=22122019"></script>
<script type="text/javascript" src="/js/handlebars-v4.0.11.js?v=22122019"></script>
<script type="text/javascript" src="/js/widgets-data.js?v=22122019"></script>
<script type="text/javascript" src="/js/widgets.js?v=22122019"></script>
<script type="text/javascript" src="/js/highlight.pack.js"></script>
<script type="text/javascript" src="/js/tocs.js"></script>
<script type="text/javascript" src="/js/menu.js"></script>
<script type="text/javascript" src="/js/stickyfill.min.js"></script>
<script type="text/javascript" src="/js/metadata.js"></script>
<script type="text/javascript" src="/js/docs.js"></script>

</body>
</html>
